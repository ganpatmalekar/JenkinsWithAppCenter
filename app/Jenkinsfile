pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Build') {
            steps {
                bat './gradlew assembleRelease'

                // Archive the APKs so that they can be downloaded from Jenkins
                archiveArtifacts '**/*.apk'
            }
        }

        stage('Upload to App Center') {
            steps {
                script {
                    appcenter(
                        credentialsId: 'b9516eda8e2b5e46b98bf189a889a4e611e62c10',
                        appSlug: 'TestFlavor',
                        artifacts: [
                            [
                                upload: 'app/build/outputs/apk/release/app-release.apk',
                                target: 'groups',
                                destinationType: 'group',
                                groupName: 'Testing Group'
                            ]
                        ]
                    )
                }
            }
        }
    }
}
